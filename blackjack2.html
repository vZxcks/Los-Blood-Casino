<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blackjack 2 - Los Blood Casino</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-6">

<h1 class="text-4xl font-bold mb-6">Blackjack 2</h1>

<div class="bg-gray-800 p-6 rounded-xl shadow-lg w-full max-w-4xl mb-6">
  <h2 class="text-2xl font-semibold mb-4">Jugadores y apuestas</h2>
  <div id="playersList" class="space-y-4">
    <div class="flex gap-2 items-center">
      <input type="text" placeholder="Nombre" class="p-2 rounded bg-gray-700 playerName">
      <input type="number" placeholder="Apuesta" class="p-2 rounded bg-gray-700 playerBet">
    </div>
  </div>
  <button onclick="addPlayer()" class="bg-blue-600 p-2 rounded hover:bg-blue-700 mt-2">Agregar jugador</button>
  <button onclick="startGame()" class="bg-green-600 p-3 rounded hover:bg-green-700 mt-4 w-full">Iniciar Juego</button>
</div>

<div id="gameContainer" class="w-full max-w-4xl"></div>

<script>
const suits=["♠","♥","♦","♣"];
const values=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
let deck=[], players=[], dealerHand=[], currentPlayer=0;

function createDeck(){
  deck=[];
  for(let s of suits){
    for(let v of values) deck.push({value:v,suit:s});
  }
  for(let i=deck.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1));
    [deck[i],deck[j]]=[deck[j],deck[i]];
  }
}

function cardValue(card){
  if(["J","Q","K"].includes(card.value)) return 10;
  if(card.value==="A") return 11;
  return parseInt(card.value);
}

function calculateScore(hand){
  let score=hand.reduce((a,b)=>a+cardValue(b),0);
  let aces=hand.filter(c=>c.value==="A").length;
  while(score>21 && aces>0){score-=10; aces--;}
  return score;
}

function deckPop(){
  if(deck.length===0) createDeck();
  return deck.pop();
}

function addPlayer(){
  if(document.getElementById("playersList").children.length>=5) return alert("Máximo 5 jugadores");
  const div=document.createElement("div");
  div.className="flex gap-2 items-center";
  div.innerHTML=`<input type="text" placeholder="Nombre" class="p-2 rounded bg-gray-700 playerName">
                 <input type="number" placeholder="Apuesta" class="p-2 rounded bg-gray-700 playerBet">`;
  document.getElementById("playersList").appendChild(div);
}

function startGame(){
  createDeck();
  players=[];
  const names=document.getElementsByClassName("playerName");
  const bets=document.getElementsByClassName("playerBet");
  for(let i=0;i<names.length;i++){
    const name=names[i].value||`Jugador${i+1}`;
    const bet=parseInt(bets[i].value)||100;
    players.push({name:name, bet:bet, hand:[deckPop(),deckPop()], finished:false});
  }
  dealerHand=[deckPop(),deckPop()];
  currentPlayer=0;
  showGame();
}

function hit(){
  players[currentPlayer].hand.push(deckPop());
  if(calculateScore(players[currentPlayer].hand)>21){
    stand();
  } else {
    showGame();
  }
}

function stand(){
  players[currentPlayer].finished=true;
  currentPlayer++;
  if(currentPlayer>=players.length){
    dealerTurn();
  } else {
    showGame();
  }
}

function dealerTurn(){
  while(calculateScore(dealerHand)<17){
    dealerHand.push(deckPop());
  }
  showGame(true);
  setTimeout(()=>resolveGame(),200);
}

function resolveGame(){
  const dealerScore=calculateScore(dealerHand);
  let results="";
  players.forEach(p=>{
    const score=calculateScore(p.hand);
    if(score>21) results+=`${p.name}: Perdiste\n`;
    else if(dealerScore>21 || score>dealerScore) results+=`${p.name}: Ganaste\n`;
    else if(score===dealerScore) results+=`${p.name}: Empate\n`;
    else results+=`${p.name}: Perdiste\n`;
  });
  alert(results);
}

function showGame(turnOver=false){
  const container=document.getElementById("gameContainer");
  let html="";
  players.forEach((p,i)=>{
    const score=calculateScore(p.hand);
    html+=`<h2 class="text-xl font-semibold mt-2">${p.name} - Apuesta: $${p.bet}</h2>
           <div class="flex gap-2 mb-2 mt-1">${p.hand.map(c=>`<div class="bg-white text-black px-3 py-4 rounded-lg shadow-md font-bold">${c.value}${c.suit}</div>`).join("")}</div>
           <p>Puntaje: ${score}</p>`;
    if(i===currentPlayer && !turnOver){
      html+=`<button onclick="hit()" class="bg-green-600 p-2 rounded m-2 hover:bg-green-700">Pedir</button>
             <button onclick="stand()" class="bg-red-600 p-2 rounded m-2 hover:bg-red-700">Plantarse</button>`;
    }
  });
  const dealerScore=calculateScore(dealerHand);
  html+=`<h2 class="text-xl font-semibold mt-4">Crupier</h2>
         <div class="flex gap-2 mb-2 mt-1">${dealerHand.map(c=>`<div class="bg-white text-black px-3 py-4 rounded-lg shadow-md font-bold">${c.value}${c.suit}</div>`).join("")}</div>
         <p>Puntaje: ${turnOver?dealerScore:'?'}</p>`;
  container.innerHTML=html;
}
</script>
</body>
</html>
